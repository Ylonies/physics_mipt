# M7A  
**Молекулярная динамика идеального газа под поршнем** — моделирование движения \(N \ge 10^3\) твёрдых шариков в замкнутом сосуде с упругими столкновениями и адиабатическими стенками.

Вариант **М7A**: адиабатический процесс под поршнем (квазистатика и резкий скачок внешнего давления), наблюдение установления равновесия и оценка скорости звука.

---

## Физическая модель

- Газ моделируется как набор одинаковых частиц массы \(m\) и радиуса \(r\) в 2D области \(0 \le x \le x_p(t)\), \(0 \le y \le L_y\).
- Столкновения:
  - **частица–частица**: упругое, без трения;
  - **частица–стенка**: зеркальное отражение;
  - **частица–поршень**:
    - в режимах 1/2 поршень движется по заданному закону, частица отражается от движущейся границы;
    - в режиме 3 поршень имеет массу \(M_p\) и обменивается импульсом с частицами (упругое 1D-столкновение по оси \(x\)).

Диагностируются:
- температура \(T(t)\) из средней кинетической энергии,
- давление на поршень \(P(t)\) из суммарного импульса столкновений с поршнем,
- объём \(V(t) = x_p(t)\,L_y\),
- (опционально) профиль плотности \(n(x,t)\) для оценки скорости звука.

---

## Режимы

1) **Режим 0 (фиксированный объём)**: поршня нет, \(V = L_x L_y\).  
2) **Режим 1 (квазистатический)**: поршень медленно движется к `piston_target`.  
3) **Режим 2 (резкий переход по объёму)**: поршень быстро движется к `piston_target`.  
4) **Режим 3 (резкий скачок внешнего давления)**: внешний пресс \(P_\mathrm{ext}\) скачком меняется в момент `t_pressure_step`, поршень движется динамически под действием \(P_\mathrm{ext}\) и столкновений с частицами.

---

## Теория для сравнения

### Скорость звука (идеальный газ, адиабатически)

\[
c = \sqrt{\gamma \frac{k_B T}{m}}
\]

Для 2D модели здесь используется \(\gamma = \frac{f+2}{f}\) при \(f=2\) (только поступательные степени свободы), т.е. \(\gamma = 2\).

В коде оценка \(c\) делается по перемещению «фронта» возмущения в профиле плотности \(n(x,t)\).

### Финальные параметры при скачке внешнего давления (режим 3)

После скачка давление снаружи постоянно: \(P_\mathrm{ext} = const\), теплообмен отсутствует (\(Q=0\)).

Для идеального газа:
- \(P_\mathrm{ext} V_f = N k_B T_f\),
- \(U = \frac{f}{2} N k_B T\),
- \(\Delta U = -P_\mathrm{ext}(V_f - V_0)\).

Отсюда:
\[
V_f = \frac{P_\mathrm{ext} V_0 + \frac{f}{2} N k_B T_0}{P_\mathrm{ext}\left(1 + \frac{f}{2}\right)}, \qquad
T_f = \frac{P_\mathrm{ext} V_f}{N k_B}.
\]

---

## Запуск

Из корня проекта:

```bash
uv run python -m src.m7a.main
```

Дальше следуйте интерактивному вводу (N, T0 и режим процесса).

---

## Тестирование

```bash
uv run pytest -q
```

Тесты для М7A проверяют:
- что финальные \(T,V\) в режиме 3 находятся в разумном согласии с теорией для процесса против постоянного \(P_\mathrm{ext}\),
- что оценка скорости звука имеет корректный порядок величины и сопоставима с \(\sqrt{\gamma k_B T/m}\),
- что крайние значения `piston_target` (0.4 и 1.0) в быстрых режимах не ломают симуляцию.


